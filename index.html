<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <title>WallFlow</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: black; color: white; touch-action: pan-y; -webkit-tap-highlight-color: transparent; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>

    <!-- Fallback Loading Screen -->
    <div id="loading" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-black">
        <div class="w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-zinc-500 text-xs tracking-widest">STARTING...</p>
    </div>

    <!-- Error Screen (Hidden by default) -->
    <div id="error-screen" class="fixed inset-0 z-[60] bg-red-900 p-8 hidden overflow-auto">
        <h1 class="text-2xl font-bold mb-4">App Crashed</h1>
        <pre id="error-msg" class="text-xs font-mono bg-black/50 p-4 rounded"></pre>
        <button onclick="window.location.reload()" class="mt-4 bg-white text-black px-6 py-3 rounded-full font-bold">Reload</button>
    </div>

    <div id="root"></div>

    <script>
        // Global Error Handler
        window.onerror = function(msg, url, line, col, error) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error-screen').style.display = 'block';
            document.getElementById('error-msg').innerText = msg + "\nLine: " + line;
        };
    </script>

    <script type="text/babel">
        // --- ICONS (SVG Paths) ---
        const ICONS = {
            Home: "M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",
            Search: "M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm10 2l-4.3-4.3",
            Heart: "M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",
            Share: "M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8m-4-6-4-4-4 4m4-4v13",
            ChevronLeft: "M15 18l-6-6 6-6",
            Eye: "M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6",
            Download: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3",
            Check: "M20 6L9 17l-5-5",
            Sparkles: "M12 3l1.9 5.8 5.8 1.9-5.8 1.9-1.9 5.8-1.9-5.8-5.8-1.9 5.8-1.9z",
            Close: "M18 6L6 18M6 6l12 12"
        };

        const Icon = ({ name, size = 24, className }) => (
            <svg 
                width={size} height={size} viewBox="0 0 24 24" 
                fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" 
                className={className}
            >
                {typeof ICONS[name] === 'string' ? <path d={ICONS[name]} /> : ICONS[name]}
            </svg>
        );

        // --- COMPONENTS ---

        const SafeImage = ({ seed, className }) => {
            // High reliability placeholder service
            const src = `https://picsum.photos/seed/${seed}/800/1200`;
            return (
                <img 
                    src={src} 
                    className={`${className} bg-zinc-800`} 
                    loading="lazy"
                    onError={(e) => e.target.style.opacity = 0.5}
                />
            );
        };

        const App = () => {
            const [tab, setTab] = React.useState('home');
            const [item, setItem] = React.useState(null);
            const [platform, setPlatform] = React.useState('ios');
            const [data, setData] = React.useState([]);
            const [favs, setFavs] = React.useState([]);
            const [search, setSearch] = React.useState('');

            // Init Data
            React.useEffect(() => {
                // Generate 50 items
                const newItems = [];
                for(let i=0; i<50; i++) {
                    newItems.push({
                        id: `id_${i}`,
                        platform: i % 2 === 0 ? 'ios' : 'android',
                        title: i % 2 === 0 ? `Nature View ${i}` : `Abstract ${i}`,
                        cat: i % 2 === 0 ? 'Nature' : 'Material',
                        seed: `seed_${i}_v4`
                    });
                }
                setData(newItems);
                
                // Hide Loading Screen safely
                const loader = document.getElementById('loading');
                if(loader) loader.style.display = 'none';

                // Load Favs
                try {
                    const saved = localStorage.getItem('wf_favs');
                    if(saved) setFavs(JSON.parse(saved));
                } catch(e) {}
            }, []);

            // Filtered Data
            const feed = React.useMemo(() => {
                let d = data.filter(i => i.platform === platform);
                if(search) d = d.filter(i => i.title.toLowerCase().includes(search.toLowerCase()));
                return d;
            }, [data, platform, search]);

            const toggleFav = (it) => {
                let next = favs.some(f => f.id === it.id) 
                    ? favs.filter(f => f.id !== it.id) 
                    : [...favs, it];
                setFavs(next);
                localStorage.setItem('wf_favs', JSON.stringify(next));
            };

            const handleShare = () => {
                if(navigator.share) {
                    navigator.share({ title: 'WallFlow', url: window.location.href }).catch(console.error);
                } else {
                    alert('Copy Link: ' + window.location.href);
                }
            };

            return (
                <div className="h-screen flex flex-col bg-black text-white font-sans">
                    
                    {/* FULL SCREEN VIEWER */}
                    {item && (
                        <div className="fixed inset-0 z-50 bg-black flex flex-col animate-[fade-in_0.2s]">
                            <SafeImage seed={item.seed} className="absolute inset-0 w-full h-full object-cover" />
                            
                            <div className="absolute top-0 left-0 w-full p-4 pt-safe-top flex justify-between z-30 bg-gradient-to-b from-black/80 to-transparent">
                                <button onClick={() => setItem(null)} className="w-10 h-10 bg-black/40 rounded-full flex items-center justify-center backdrop-blur-md border border-white/10">
                                    <Icon name="ChevronLeft" />
                                </button>
                                <button onClick={() => toggleFav(item)} className={`w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-md border border-white/10 ${favs.some(f=>f.id===item.id)?'bg-red-500/80':'bg-black/40'}`}>
                                    <Icon name="Heart" />
                                </button>
                            </div>

                            <div className="absolute bottom-0 left-0 w-full p-6 pb-safe-bottom z-30 bg-gradient-to-t from-black via-black/80 to-transparent flex flex-col gap-4">
                                <h2 className="text-3xl font-bold">{item.title}</h2>
                                <div className="flex gap-3">
                                    <button onClick={() => alert('Feature coming soon')} className="flex-1 h-12 bg-white/20 rounded-full font-bold flex items-center justify-center gap-2 backdrop-blur-md border border-white/10">
                                        <Icon name="Eye" size={20} /> Preview
                                    </button>
                                    <button onClick={() => alert('Long press image to save')} className="flex-1 h-12 bg-white text-black rounded-full font-bold flex items-center justify-center gap-2">
                                        <Icon name="Download" size={20} /> Save
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* HEADER */}
                    {tab === 'home' && (
                        <div className="pt-safe-top bg-zinc-900/80 backdrop-blur-xl border-b border-zinc-800 sticky top-0 z-40">
                            <div className="flex justify-between items-center px-4 py-3">
                                <div className="w-8"></div>
                                <div className="flex bg-black/30 p-1 rounded-full border border-white/5">
                                    <button onClick={() => setPlatform('ios')} className={`px-4 py-1 rounded-full text-xs font-bold transition-all ${platform==='ios'?'bg-blue-600 text-white':'text-zinc-400'}`}>iOS</button>
                                    <button onClick={() => setPlatform('android')} className={`px-4 py-1 rounded-full text-xs font-bold transition-all ${platform==='android'?'bg-green-600 text-white':'text-zinc-400'}`}>Android</button>
                                </div>
                                <button onClick={handleShare} className="text-blue-500"><Icon name="Share" /></button>
                            </div>
                        </div>
                    )}

                    {/* CONTENT */}
                    <div className="flex-1 overflow-y-auto p-4 hide-scroll pb-24">
                        {tab === 'home' && (
                            <>
                                <div className="mb-6 flex items-center gap-2 text-zinc-500 text-xs font-bold uppercase tracking-wider">
                                    <Icon name="Sparkles" size={14} /> Weekly Drop
                                </div>
                                {feed.length > 0 && (
                                    <div onClick={() => setItem(feed[0])} className="w-full aspect-[4/3] rounded-2xl overflow-hidden relative mb-8 shadow-xl bg-zinc-900">
                                        <SafeImage seed={feed[0].seed} className="w-full h-full object-cover" />
                                        <div className="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent flex flex-col justify-end p-4">
                                            <h3 className="text-xl font-bold">{feed[0].title}</h3>
                                        </div>
                                    </div>
                                )}
                                <div className="grid grid-cols-2 gap-4">
                                    {feed.slice(1).map(i => (
                                        <div key={i.id} onClick={() => setItem(i)} className="relative aspect-[9/16] rounded-xl overflow-hidden bg-zinc-900">
                                            <SafeImage seed={i.seed} className="w-full h-full object-cover" />
                                        </div>
                                    ))}
                                </div>
                            </>
                        )}

                        {tab === 'search' && (
                            <div className="pt-safe-top">
                                <div className="bg-zinc-900 rounded-xl flex items-center px-4 py-3 border border-zinc-800 mb-4">
                                    <Icon name="Search" className="text-zinc-500 mr-2" />
                                    <input autoFocus placeholder="Search..." value={search} onChange={e=>setSearch(e.target.value)} className="bg-transparent w-full outline-none text-white placeholder:text-zinc-600" />
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    {feed.map(i => (
                                        <div key={i.id} onClick={() => setItem(i)} className="relative aspect-[9/16] rounded-xl overflow-hidden bg-zinc-900">
                                            <SafeImage seed={i.seed} className="w-full h-full object-cover" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {tab === 'saved' && (
                            <div className="pt-safe-top">
                                <h2 className="text-2xl font-bold mb-6">Saved</h2>
                                {favs.length === 0 ? <div className="text-center text-zinc-600 mt-20">No favorites yet</div> : (
                                    <div className="grid grid-cols-2 gap-4">
                                        {favs.map(i => (
                                            <div key={i.id} onClick={() => setItem(i)} className="relative aspect-[9/16] rounded-xl overflow-hidden bg-zinc-900">
                                                <SafeImage seed={i.seed} className="w-full h-full object-cover" />
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* TABS */}
                    <div className="fixed bottom-0 w-full bg-zinc-900/90 backdrop-blur border-t border-zinc-800 pb-safe-bottom pt-2 flex justify-around z-40">
                        <button onClick={() => setTab('home')} className={`flex flex-col items-center gap-1 ${tab==='home'?'text-white':'text-zinc-600'}`}>
                            <Icon name="Home" /> <span className="text-[10px]">Feed</span>
                        </button>
                        <button onClick={() => setTab('search')} className={`flex flex-col items-center gap-1 ${tab==='search'?'text-white':'text-zinc-600'}`}>
                            <Icon name="Search" /> <span className="text-[10px]">Search</span>
                        </button>
                        <button onClick={() => setTab('saved')} className={`flex flex-col items-center gap-1 ${tab==='saved'?'text-white':'text-zinc-600'}`}>
                            <Icon name="Heart" /> <span className="text-[10px]">Saved</span>
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


