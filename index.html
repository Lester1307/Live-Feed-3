<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <title>WallFlow</title>
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { background-color: black; color: white; -webkit-tap-highlight-color: transparent; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .glass { background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- INTERNAL ICONS ---
        const Icon = ({ name, size = 24, className }) => {
            const paths = {
                Home: "M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",
                Search: "M11 19a8 8 0 1 0 0-16 8 8 0 0 0 0 16zm10 2l-4.3-4.3",
                Heart: "M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",
                Share: "M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8m-4-6-4-4-4 4m4-4v13",
                ChevronLeft: "M15 18l-6-6 6-6",
                Eye: "M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6",
                Download: "M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3",
                Check: "M20 6L9 17l-5-5",
                Sparkles: "M12 3l1.9 5.8 5.8 1.9-5.8 1.9-1.9 5.8-1.9-5.8-5.8-1.9 5.8-1.9z",
                Lock: "M7 11V7a5 5 0 0 1 10 0v4",
                Phone: "M12 18h.01M5 2h14a2 2 0 0 1 2 2v20a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"
            };
            
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d={paths[name]} />
                    {name === 'Lock' && <rect x="3" y="11" width="18" height="11" rx="2" ry="2" />}
                </svg>
            );
        };

        // --- IMAGE COMPONENT ---
        const SafeImage = ({ seed, className }) => {
            const src = `https://picsum.photos/seed/${seed}/800/1200`;
            return <img src={src} className={`${className} bg-zinc-900 transition-opacity duration-700`} loading="lazy" crossOrigin="anonymous" />;
        };

        // --- FULL SCREEN VIEWER (Fixed Logic) ---
        const Viewer = ({ item, onClose, isFav, toggleFav, platform }) => {
            const [mode, setMode] = useState('view');
            const [time, setTime] = useState(new Date());
            const [saving, setSaving] = useState(false);

            useEffect(() => {
                const t = setInterval(() => setTime(new Date()), 1000);
                return () => clearInterval(t);
            }, []);

            const handleSave = async () => {
                setSaving(true);
                const url = `https://picsum.photos/seed/${item.seed}/1080/1920`;
                
                try {
                    // Try robust fetch method
                    const response = await fetch(url);
                    const blob = await response.blob();
                    const blobUrl = URL.createObjectURL(blob);
                    
                    const link = document.createElement('a');
                    link.href = blobUrl;
                    link.download = `Wallpaper-${item.id}.jpg`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(blobUrl);
                    
                    setTimeout(() => setSaving(false), 2000);
                } catch (e) {
                    // Fallback for iOS restriction
                    window.open(url, '_blank');
                    setSaving(false);
                }
            };

            const dateStr = time.toLocaleDateString([], {weekday: 'short', month: 'short', day: 'numeric'});
            const timeStr = time.toLocaleTimeString([], {hour: 'numeric', minute:'2-digit'});

            return (
                <div className="fixed inset-0 z-50 bg-black flex flex-col animate-[fade-in_0.2s]">
                    <SafeImage seed={item.seed} className="absolute inset-0 w-full h-full object-cover" />
                    
                    {/* iOS Preview Overlay */}
                    {mode === 'preview' && platform === 'ios' && (
                        <div className="absolute inset-0 z-20 flex flex-col items-center pt-24 text-white pointer-events-none">
                            <Icon name="Lock" className="mb-4 opacity-70" />
                            <div className="text-xl font-medium opacity-80 mb-1 drop-shadow-md">{dateStr}</div>
                            <div className="text-8xl font-bold tracking-tight drop-shadow-lg font-sans">{timeStr}</div>
                            <div className="absolute bottom-12 w-full px-12 flex justify-between opacity-60">
                                <div className="w-12 h-12 rounded-full bg-black/40 backdrop-blur-md"></div>
                                <div className="w-12 h-12 rounded-full bg-black/40 backdrop-blur-md"></div>
                            </div>
                        </div>
                    )}

                    {/* Android Preview Overlay */}
                    {mode === 'preview' && platform === 'android' && (
                        <div className="absolute inset-0 z-20 flex flex-col justify-between p-8 text-white pointer-events-none">
                            <div className="mt-16">
                                <div className="text-[5.5rem] font-bold leading-none drop-shadow-lg">
                                    {timeStr.split(' ')[0]}
                                </div>
                                <div className="text-xl opacity-90 mt-2">{dateStr}</div>
                            </div>
                            <div className="flex justify-center mb-8 opacity-70">
                                <Icon name="Lock" />
                            </div>
                        </div>
                    )}

                    {/* Controls */}
                    {mode === 'view' && (
                        <>
                            <div className="absolute top-0 left-0 w-full p-4 pt-safe-top flex justify-between z-30 bg-gradient-to-b from-black/80 to-transparent">
                                <button onClick={onClose} className="w-10 h-10 bg-black/40 backdrop-blur-md rounded-full flex items-center justify-center border border-white/10">
                                    <Icon name="ChevronLeft" />
                                </button>
                                <button onClick={() => toggleFav(item)} className={`w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-md border border-white/10 ${isFav?'bg-red-500/80':'bg-black/40'}`}>
                                    <Icon name="Heart" />
                                </button>
                            </div>

                            <div className="absolute bottom-0 left-0 w-full p-6 pb-safe-bottom z-30 bg-gradient-to-t from-black via-black/80 to-transparent flex flex-col gap-6">
                                {/* Title shown ONLY inside viewer for context, but hidden on grid as requested */}
                                <div>
                                    <h2 className="text-3xl font-bold">{item.title}</h2>
                                    <span className="text-xs bg-white/20 px-2 py-1 rounded font-bold uppercase">{platform}</span>
                                </div>

                                <div className="flex gap-3">
                                    <button onClick={() => setMode('preview')} className="flex-1 h-12 bg-white/20 rounded-full font-bold flex items-center justify-center gap-2 backdrop-blur-md border border-white/10 active:scale-95 transition">
                                        <Icon name="Eye" size={20} /> Preview
                                    </button>
                                    <button onClick={handleSave} className="flex-1 h-12 bg-white text-black rounded-full font-bold flex items-center justify-center gap-2 active:scale-95 transition">
                                        {saving ? <div className="w-5 h-5 border-2 border-black border-t-transparent rounded-full animate-spin"/> : <><Icon name="Download" size={20} /> Save</>}
                                    </button>
                                </div>
                            </div>
                        </>
                    )}
                    
                    {/* Exit Preview Tap Area */}
                    {mode === 'preview' && <div className="absolute inset-0 z-50 cursor-pointer" onClick={() => setMode('view')} />}
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [tab, setTab] = useState('home');
            const [item, setItem] = useState(null);
            const [platform, setPlatform] = useState('ios');
            const [data, setData] = useState([]);
            const [favs, setFavs] = useState([]);
            const [search, setSearch] = useState('');

            // Data Generator
            useEffect(() => {
                const items = [];
                // Create 100 items
                for(let i=0; i<100; i++) {
                    const isIOS = i % 2 === 0;
                    items.push({
                        id: `wp_${i}`,
                        platform: isIOS ? 'ios' : 'android',
                        title: isIOS ? `Nature ${i}` : `Abstract ${i}`,
                        seed: `wallflow_${isIOS?'ios':'and'}_${i}_v5`,
                        cat: isIOS ? 'nature' : 'abstract'
                    });
                }
                setData(items);
                
                const saved = localStorage.getItem('wf_favs');
                if(saved) setFavs(JSON.parse(saved));
            }, []);

            const toggleFav = (it) => {
                let next = favs.some(f => f.id === it.id) ? favs.filter(f => f.id !== it.id) : [...favs, it];
                setFavs(next);
                localStorage.setItem('wf_favs', JSON.stringify(next));
            };

            const handleShare = () => {
                if(navigator.share) {
                    navigator.share({ title: 'WallFlow', url: window.location.href }).catch(() => {});
                } else {
                    alert("Copy Link: " + window.location.href);
                }
            };

            // Filter logic
            const feed = useMemo(() => {
                let d = data.filter(i => i.platform === platform);
                if(search) d = d.filter(i => i.title.toLowerCase().includes(search.toLowerCase()));
                return d.sort(() => 0.5 - Math.random()); // Random shuffle
            }, [data, platform, search]);

            return (
                <div className="h-screen flex flex-col bg-black text-white font-sans">
                    
                    {item && <Viewer item={item} onClose={() => setItem(null)} isFav={favs.some(f=>f.id===item.id)} toggleFav={toggleFav} platform={platform} />}

                    {/* Header */}
                    {tab === 'home' && (
                        <div className="pt-safe-top glass border-b border-white/5 sticky top-0 z-40">
                            <div className="flex justify-between items-center px-4 py-3">
                                <div className="w-8"></div>
                                <div className="flex bg-black/40 p-1 rounded-full border border-white/10">
                                    <button onClick={() => setPlatform('ios')} className={`px-4 py-1.5 rounded-full text-xs font-bold transition-all ${platform==='ios'?'bg-blue-600 text-white':'text-zinc-400'}`}>iOS</button>
                                    <button onClick={() => setPlatform('android')} className={`px-4 py-1.5 rounded-full text-xs font-bold transition-all ${platform==='android'?'bg-green-600 text-white':'text-zinc-400'}`}>Android</button>
                                </div>
                                <button onClick={handleShare} className="text-blue-500 active:scale-90 transition"><Icon name="Share" /></button>
                            </div>
                        </div>
                    )}

                    {/* Content Area */}
                    <div className="flex-1 overflow-y-auto p-4 hide-scroll pb-24">
                        
                        {tab === 'home' && (
                            <>
                                {/* Hero Item */}
                                <div className="mb-6" onClick={() => setItem(feed[0])}>
                                    <div className="flex items-center gap-2 mb-2 text-zinc-500 text-xs font-bold uppercase tracking-wider"><Icon name="Sparkles" size={14} /> Weekly Highlight</div>
                                    {feed[0] && (
                                        <div className="w-full aspect-[4/3] rounded-2xl overflow-hidden relative shadow-2xl bg-zinc-900">
                                            <SafeImage seed={feed[0].seed} className="w-full h-full object-cover" />
                                        </div>
                                    )}
                                </div>

                                {/* Clean Grid - No Titles */}
                                <div className="flex items-center gap-2 mb-3 mt-6 text-zinc-500 text-xs font-bold uppercase tracking-wider"><Icon name="Check" size={14} /> Trending</div>
                                <div className="grid grid-cols-2 gap-4 pb-12">
                                    {feed.slice(1).map(i => (
                                        <div key={i.id} onClick={() => setItem(i)} className="relative aspect-[9/16] rounded-xl overflow-hidden bg-zinc-900 active:scale-95 transition-transform">
                                            <SafeImage seed={i.seed} className="w-full h-full object-cover" />
                                        </div>
                                    ))}
                                </div>
                            </>
                        )}

                        {tab === 'search' && (
                            <div className="pt-safe-top">
                                <div className="bg-zinc-900 rounded-xl flex items-center px-4 py-3 border border-zinc-800 mb-4 sticky top-4 z-30">
                                    <Icon name="Search" className="text-zinc-500 mr-2" />
                                    <input autoFocus placeholder="Search..." value={search} onChange={e=>setSearch(e.target.value)} className="bg-transparent w-full outline-none text-white placeholder:text-zinc-600" />
                                </div>
                                <div className="grid grid-cols-2 gap-4 pb-20">
                                    {feed.map(i => (
                                        <div key={i.id} onClick={() => setItem(i)} className="relative aspect-[9/16] rounded-xl overflow-hidden bg-zinc-900">
                                            <SafeImage seed={i.seed} className="w-full h-full object-cover" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {tab === 'saved' && (
                            <div className="pt-safe-top">
                                <h2 className="text-2xl font-bold mb-6 mt-4">Favorites</h2>
                                {favs.length === 0 ? <div className="text-center text-zinc-600 mt-20">No favorites yet</div> : (
                                    <div className="grid grid-cols-2 gap-4 pb-20">
                                        {favs.map(i => (
                                            <div key={i.id} onClick={() => setItem(i)} className="relative aspect-[9/16] rounded-xl overflow-hidden bg-zinc-900">
                                                <SafeImage seed={i.seed} className="w-full h-full object-cover" />
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Bottom Nav */}
                    <div className="fixed bottom-0 w-full glass border-t border-white/5 pb-safe-bottom pt-2 flex justify-around z-40">
                        <button onClick={() => setTab('home')} className={`flex flex-col items-center gap-1 ${tab==='home'?'text-white':'text-zinc-600'}`}>
                            <Icon name="Home" /> <span className="text-[10px]">Feed</span>
                        </button>
                        <button onClick={() => setTab('search')} className={`flex flex-col items-center gap-1 ${tab==='search'?'text-white':'text-zinc-600'}`}>
                            <Icon name="Search" /> <span className="text-[10px]">Search</span>
                        </button>
                        <button onClick={() => setTab('saved')} className={`flex flex-col items-center gap-1 ${tab==='saved'?'text-white':'text-zinc-600'}`}>
                            <Icon name="Heart" /> <span className="text-[10px]">Saved</span>
                        </button>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


